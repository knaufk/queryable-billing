<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Queryable Billing</title>

        <meta name="description" content="How to Build a Billing System without a Database">
        <meta name="author" content="Maximilian Bode, Konstantin Knauf">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="stylesheet" href="css/reveal.min.css">
        <link rel="stylesheet" href="css/theme/tng.css" id="theme">
        <link rel="stylesheet" href="css/custom.css">
        <link rel="stylesheet" href="lib/css/github.css">

        <link rel="stylesheet" href="custom.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">


        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="reveal">
            <div class="slides">
                <section data-markdown data-separator="^\n---\n$" data-separator-vertical="^\n--\n$" data-separator-notes="^\n\[\[">
                    <script type="text/template">
## How to Build a Billing System without a Database

[Maximilian Bode](mailto:maximilian.bode@tngtech.com),
[Konstantin Knauf](mailto:konstantin.knauf@tngtech.com)

--

## Who are we?

<img src="img/konstantin.jpg" height="300">
<img src="img/max.jpg" height="300">

<img src="img/tng.png" width="300">


[[
* TNG Technology Consulting, a Munich-based consulting firm focused on high-end information technology
* both currently on a project with one of Europe’s largest telecommunications providers
* built a platform processing billions of events per day

--

## Why this talk?

[[
* deal a lot with stream processing, excited about Flink
* stumbled across use case that made sense to implement using queryable state
* happy to share our prototype today

---

## Queryable State

--

### Evolution of Streaming Architecture
* Lambda Architecture
* External Key-Value Store
* Fault-tolerant Stream Processor

[[
TODO

--

### Flink's Implementation

#### Basic Flow

<img src="img/QueryableStateFlow.svg" width="1000">

---

## Use Case

--

### Functional Requirements

![Use Case](img/qb-sketch-640x420.png "Queryable Billing")

[[

#### User Stories

* As the invoicing system I want to receive the total amount due at the end of each month, so that I can issue correct invoices to each customer.
* As a postpaid customer I want to be able check my current amount due during the month so that I can adjust my usage behaviour accordingly.
* As a marketing manager I want to know how much money my customers are currently spending on the different types of products to make real-time adjustments to my campaigns.

--

### Non-Functional Requirements

* Completeness & Correctness
* Scalability
* Availability
* Robustness
    * Out-of-Order-Events
    * Late Arriving Events
    * Variable Volume
    * Partial Failures

--

#### Design/Jobgraph/Connectors

* Flink Job
    * Kafka Source
    * TimeWindows
        * Aggregation
        * Queryable State
    * BucketingSink
* Spring Boot Server
    * QueryableStateClient
* Frontend

[[
TODO idea: qb-sketch here again, logos (Flink, Spring Boot, React/Redux, Kafka, HDFS) appear one after the other
* exactly-once for invoices

---

## Demo

--

### Docker Setup?

--

### Good Case 1 (No Queryable State)

--

### Good Case 2 (Queryable State)

--

### Taskmanager Failure

--

### Jobmanager Failure

--

### Failure of Downstream Systems

---

## Current limitations, outlook
                    </script>
                </section>
                <section>
                    <section>
                        <table class="contacts">
                            <tr>
                                <td><i class="fa fa-envelope" aria-hidden="true"></i></td>
                                <td><a href="mailto:maximilian.bode@tng.tech">maximilian.bode@tng.tech</a></td>
                                <td><i class="fa fa-envelope" aria-hidden="true"></i></td>
                                <td><a href="mailto:konstantin.knauf@tng.tech">konstantin.knauf@tng.tech</a></td>
                            </tr>
                            <tr>
                                <td><i class="fa fa-linkedin" aria-hidden="true"></i></td>
                                <td><a href="http://lnked.in/maxbode">lnked.in/maxbode</a></td>
                                <td><i class="fa fa-twitter" aria-hidden="true"></i></td>
                                <td><a href="https://twitter.com/snntrable">@snntrable</a></td>
                            </tr>
                        </table>
                        <br/>
                        <a href="http://www.tngtech.com"><img class="logo" src="img/tng.png" width="300"></a>
                    </section>
                </section>
            </div>

            </div>
           <p class="copyright">© TNG Technology Consulting 2011 - 2017</p>
        </div>

        <script src="lib/js/head.js"></script>
        <script src="js/vendor/reveal.js"></script>

        <script>
            // Full list of configuration options available at:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,
                rollingLinks: false,
                width: 1024,
                height: 768,

                transition: 'slide', // none/fade/slide/convex/concave/zoom linear?

                markdown: {
                   smartypants: true
                },

                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js' },
                    { src: 'plugin/markdown/markdown.js' },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() {
                        hljs.initHighlightingOnLoad();
                        Array.prototype.forEach.call(document.querySelectorAll('pre>code'), function(node) {
                            var text = node.innerHTML;

                            text = text.replace(/\^([0-9]+)\^(((?!\^\^)(.|\n))*)\^\^/g, '<span class="fragment highlight" data-fragment-index="$1">$2</span>');
                            text = text.replace(/\^\^(((?!\^\^)(.|\n))*)\^\^/g, '<span class="highlight">$1</span>');

                            node.innerHTML = text;
                        });
                    } },
                    { src: 'plugin/zoom-js/zoom.js', async: true },
                    { src: 'plugin/notes/notes.js', async: true }
                ]
            });
        </script>

    </body>
</html>
